<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<head>
    <title>登录日志</title>
    <div th:replace="/admin/common/head"></div>
</head>
<body class="body-main">

<div class="layui-fluid">
    <div class="layui-card">
        <div class="layui-card-header">登录日志</div>

        <div class="layui-card-body">
            <!-- 搜索条件 -->
            <div class="layui-collapse" lay-filter="search-box">
                <div class="layui-colla-item">
                    <h2 class="layui-colla-title">搜索条件</h2>
                    <div class="layui-colla-content">
                        <div class="layui-form-item">
                            <div class="layui-inline">
                                <label class="layui-form-label">账户</label>
                                <div class="layui-input-inline">
                                    <input type="text" id="userName" autocomplete="off" class="layui-input" placeholder="请输入">
                                </div>
                            </div>
                            <div class="layui-inline layui-show-xs-block">
                                <button type="button" data-type="refresh" class="layui-btn layui-btn-sm layui-btn-normal bind-operation">
                                    <i class="layui-icon">&#xe615;</i>查询
                                </button>
                                <button type="button" data-type="reset" class="layui-btn layui-btn-sm layui-btn-primary bind-operation">
                                    <i class="layui-icon">&#xe666;</i>重置
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="layui-card-body">
            <!-- 表格 -->
            <table class="layui-hide" id="dataTable" lay-filter="dataTableFilter"></table>
            <!-- 头按钮 -->
            <script type="text/html" id="headBar">
                <button type="button" lay-event="refresh" class="layui-btn layui-btn-normal layui-btn-sm"><i class="layui-icon">&#xe669;</i>刷新</button>
                <button type="button" lay-event="batchDel" class="layui-btn layui-btn-danger layui-btn-sm"><i class="layui-icon">&#xe640;</i>批量删除</button>
            </script>
            <!-- 行按钮 -->
            <script type="text/html" id="rowBar">
                <a class="layui-btn layui-btn-danger layui-btn-sm" lay-event="del"><i class="layui-icon">&#xe640;</i>删除</a>
            </script>
        </div>
    </div>
</div>

<div th:replace="/admin/common/js"></div>
<script th:inline="none">
    layui.use(['laypage', 'layer', 'table', 'element'], function () {
        var laypage = layui.laypage //分页
            , layer = layui.layer //弹层
            , table = layui.table //表格
            , $ = layui.$;

        // 执行一个 table 实例
        table.render({
            elem: '#dataTable'
            , id: 'dataTable'
            , method: 'post'
            , url: '/loginLog/listLoginLog'
            , page: true
            , toolbar: '#headBar'
            , cols: [[
                {type: 'checkbox'}
                , {type: 'numbers', title: '序号'}
                , {field: 'userName', title: '账户'}
                , {field: 'code', title: '状态码', templet: function (d) {
                        if (d.code == 200) {
                            return '<span class="layui-badge layui-bg-green">' + d.code + '</span>';
                        } else {
                            return '<span class="layui-badge layui-bg-black">' + d.code + '</span>';
                        }
                    }}
                , {field: 'message', title: '消息'}
                , {field: 'ip', title: 'IP地址'}
                , {field: 'location', title: '登录地点'}
                , {field: 'createTime', title: '登录时间'}
                , {field: 'device', title: '登录设备'}
                , {fixed: 'right', width: 100, toolbar: '#rowBar'}
            ]]
        });

        var active = {
            refresh: function () {
                table.reload('dataTable', {
                    where: {
                        userName: $("#userName").val()
                    }
                });
            },
            reset: function () {
                $("#userName").val("");
                table.reload('dataTable', {
                    page: {
                        curr: 1 // 重新从第 1 页开始
                    }
                    , where: {
                        userName: ''
                    }
                });
            },
            del: function (id) {
                alert('删除id: ' + id);
            },
            batchDel: function (data) {
                var ids = [];
                for (var i = 0; i < data.length; i++) {
                    ids.push(data[i].id);
                }
                if (ids.length == 0) {
                    layer.msg('还没有勾选要删除的数据!');
                    return;
                }
            }
        };

        // 监听头工具栏事件
        table.on('toolbar(dataTableFilter)', function (obj) {
            var checkStatus = table.checkStatus(obj.config.id)
                , data = checkStatus.data;
            if (obj.event === 'refresh') {
                active.refresh();
            } else if (obj.event === 'batchDel') {
                active.batchDel(data);
            }
        });

        // 监听行工具事件
        table.on('tool(dataTableFilter)', function (obj) {
            var data = obj.data
                , layEvent = obj.event;
            if (layEvent === 'del') {
                layer.msg(data.id);
            }
        });

        // 全局按钮监听
        $('.bind-operation').on('click', function () {
            var type = $(this).data('type');
            active[type] ? active[type].call(this) : '';
        });
    });
</script>
</body>
</html>