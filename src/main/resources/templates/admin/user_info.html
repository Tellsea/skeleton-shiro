<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<head>
    <title>用户管理 - Skeleton</title>
    <div th:replace="/admin/common/head"></div>
</head>
<body>

<div class="layui-fluid">
    <div class="layui-card">
        <div class="layui-card-header">用户管理</div>

        <!-- 搜索条件 -->
        <div class="layui-card-body">
            <div class="layui-collapse" lay-filter="test">
                <div class="layui-colla-item">
                    <h2 class="layui-colla-title">搜索条件</h2>
                    <div class="layui-colla-content layui-show">
                        <form class="layui-form" action="" lay-filter="component-form-group">
                            <div class="layui-form-item">
                                <div class="layui-inline">
                                    <label class="layui-form-label">验证手机</label>
                                    <div class="layui-input-inline">
                                        <input type="tel" name="phone" lay-verify="required|phone" autocomplete="off"
                                               class="layui-input">
                                    </div>
                                </div>
                                <div class="layui-inline">
                                    <label class="layui-form-label">验证邮箱</label>
                                    <div class="layui-input-inline">
                                        <input type="text" name="email" lay-verify="email" autocomplete="off"
                                               class="layui-input">
                                    </div>
                                </div>
                                <div class="layui-inline">
                                    <div class="layui-input-block" style="margin-left: 0;">
                                        <button class="layui-btn layui-btn-normal layui-btn-sm bind-event" data-type="query" title="查询">
                                            <i class="layui-icon layui-icon-search"></i>
                                        </button>
                                        <button class="layui-btn layui-btn-primary layui-btn-sm bind-event" data-type="reset" title="重置">
                                            <i class="layui-icon layui-icon-refresh"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <div class="layui-card-body">
            <table id="dataTable" lay-filter="dataTableFilter"></table>
            <script type="text/html" id="imgTpl">
                <img style="display: inline-block; width: 50%; height: 100%;" src={{ d.avatar }}>
            </script>
            <!-- 头按钮 -->
            <script type="text/html" id="headBar">
                <button class="layui-btn layui-btn-normal layui-btn-sm" lay-event="refresh" title="刷新">
                    <i class="layui-icon layui-icon-refresh"></i>
                </button>
                <button class="layui-btn layui-btn-sm" lay-event="add" title="新增">
                    <i class="layui-icon layui-icon-add-1"></i>
                </button>
                <button class="layui-btn layui-btn-sm layui-btn-danger" lay-event="batchDel" title="批量删除">
                    <i class="layui-icon layui-icon-close"></i>
                </button>
            </script>
            <!-- 行按钮 -->
            <script type="text/html" id="rowBar">
                <a class="layui-btn layui-btn-primary layui-btn-sm" lay-event="detail" title="查看">
                    <i class="layui-icon layui-icon-note"></i>
                </a>
                <a class="layui-btn layui-btn-normal layui-btn-sm" lay-event="edit" title="编辑">
                    <i class="layui-icon layui-icon-edit"></i>
                </a>
                <a class="layui-btn layui-btn-danger layui-btn-sm" lay-event="del" title="删除">
                    <i class="layui-icon layui-icon-delete"></i>
                </a>
            </script>
        </div>
    </div>
</div>

<div th:replace="/admin/common/js"></div>
<script th:inline="none">
    layui.config({
        base: '/assets/lib/layuiadmin/'
    }).use(['form', 'table', 'element'], function () {
        var $ = layui.$
            , form = layui.form
            , index = layui.index
            , table = layui.table;

        //执行一个 table 实例
        table.render({
            elem: '#dataTable'
            , method: 'post'
            , url: '/userInfo/listUserInfo'
            , page: true
            , toolbar: '#headBar'
            , cols: [[
                {type: 'checkbox'}
                , {type:'numbers', title: '序号'}
                , {field: 'userName', title: '用户名'}
                , {field: 'nickName', title: '昵称'}
                , {field: 'avatar', title: '头像', templet: '#imgTpl'}
                , {field: 'sex', title: '性别', templet: function (d) {
                        if (d.sex == 1) {
                            return "男";
                        } else if (d.sex == 2) {
                            return "女";
                        } else {
                            return "";
                        }
                    }
                }
                , {field: 'phone', title: '手机号码'}
                , {field: 'description', title: '描述'}
                , {field: 'createUserName', title: '创建人'}
                , {field: 'createTime', title: '创建时间'}
                , {field: 'status', title: '状态', templet: function (d) {
                    if (d.status == 0) {
                        return '<span class="layui-badge layui-bg-green">正常</span>'
                    } else if (d.status == 1) {
                        return '<span class="layui-badge layui-bg-orange">锁定</span>'
                    } else if (d.status == 2) {
                        return '<span class="layui-badge layui-bg-green">删除</span>'
                    }
                }}
                , {fixed: 'right', width: 180, toolbar: '#rowBar'}
            ]]
        });

        var active = {
            refresh: function () {
                table.reload('dataTable', {
                    where: {
                        userName: $("#userName").val()
                    }
                });
            },
            reset: function () {
                $("#userName").val("");
                table.reload('dataTable', {
                    page: {
                        curr: 1 // 重新从第 1 页开始
                    }
                    , where: {
                        userName: ''
                    }
                });
            },
            del: function (id) {
                alert('删除id: ' + id);
            },
            batchDel: function (data) {
                var ids = [];
                for (var i = 0; i < data.length; i++) {
                    ids.push(data[i].id);
                }
                if (ids.length == 0) {
                    layer.msg('还没有勾选要删除的数据!');
                    return;
                }
            }
        };

        //监听指定开关
        form.on('switch(switchTest)', function(data){
            layer.msg('开关checked：'+ (this.checked ? 'true' : 'false'), {
                offset: '6px'
            });
            layer.tips('温馨提示：请注意开关状态的文字可以随意定义，而不仅仅是ON|OFF', data.othis)
        });

        // 监听头工具栏事件
        table.on('toolbar(dataTableFilter)', function (obj) {
            var checkStatus = table.checkStatus(obj.config.id)
                , data = checkStatus.data; //获取选中的数据
            if (obj.event === "refresh") {
                active.refresh();
            } else if (obj.event === "add") {
                window.parent.openTabsPage("aaa", "新增用户");
            } else if (obj.event === "batchDel") {

            }
        });

        // 监听行工具事件
        table.on('tool(dataTableFilter)', function (obj) {
            var data = obj.data //获得当前行数据
                , layEvent = obj.event; //获得 lay-event 对应的值
            if (layEvent === 'detail') {
                layer.msg('查看操作');
            } else if (layEvent === 'del') {
                layer.confirm('真的删除行么', function (index) {
                    obj.del(); //删除对应行（tr）的DOM结构
                    layer.close(index);
                    //向服务端发送删除指令
                });
            } else if (layEvent === 'edit') {
                layer.msg('编辑操作');
            }
        });

        // 全局按钮监听
        $('.bind-event').on('click', function () {
            var type = $(this).data('type');
            active[type] ? active[type].call(this) : '';
        });
    });
</script>
</body>
</html>
